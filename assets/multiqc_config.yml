report_comment: >
  This report has been generated by the <a href="https://github.com/scilus/nf-tractoflow/" target="_blank">scilus/nf-tractoflow</a>
  analysis pipeline.

report_section_order:
  "nf-tractoflow-summary":
    order: -1001
  "shell_qc":
    order: -600
  "topup_qc":
    order: -625
  "eddy_qc":
    order: -650
  framewise_displacement:
    order: -640
  "anattodwi_qc":
    order: -680
  "metrics_qc":
    order: -675
  "tracking_qc":
    order: -725
  "nf-pediatric-methods-description":
    order: -900
  software_versions:
    order: -1000

custom_content:
  order:
    - shell_qc
    - topup_qc
    - eddy_qc
    - anattodwi_qc
    - metrics_qc
    - tracking_qc

custom_data:
  shell_qc:
    file_format: "tsv"
    section_name: "Shell QC"
    description: |
      This section contains QC images for the diffusion shell, displaying
      the distribution of b-vectors on the sphere. This visualization ensures
      that the diffusion-weighted gradient directions are correctly assigned
      and evenly distributed, which is critical for accurate modeling of
      diffusion properties. To assess the quality of the b-vectors, check that
      the gradient directions form a uniform and symmetric distribution on
      the sphere, corresponding to the expected acquisition scheme (e.g.,
      single-shell, multi-shell). Look for missing or misaligned directions,
      which may indicate acquisition or preprocessing errors.
    plot_type: "image"
  eddy_qc:
    file_format: "gif"
    section_name: "Eddy QC"
    description: |
      This section contains QC images for EDDY correction, which is used to
      correct distortions and motion artifacts. The animation shows a
      before-and-after comparison of the correction. To assess the quality of
      the correction, focus on areas prone to distortions, such as the frontal
      lobe and the cerebellum/spinal cord region. Look for reduced geometric warping,
      improved alignment with anatomical boundaries, and correction of
      eddy-current-induced displacements. Additionally, ensure that no new
      artifacts or excessive blurring are introduced in the corrected images.
    plot_type: "image"
  topup_qc:
    file_format: "gif"
    section_name: "Topup QC"
    description: |
      This section contains QC images for TOPUP correction, which is used to correct
      susceptibility-induced distortions by leveraging pairs of images acquired with
      opposite phase-encoding directions. The animation shows a before-and-after
      comparison of the correction. To assess the quality of the correction, focus
      on regions most affected by susceptibility distortions, such as the frontal lobe
      and the cerebellum/spinal cord area. Look for improved alignment of anatomical
      structures, reduced stretching or compression, and better symmetry between the
      corrected images. Additionally, ensure that the correction does not introduce
      new artifacts or excessive blurring.
    plot_type: "image"
  anattodwi_qc:
    file_format: "gif"
    section_name: "Registration of anatomical image in DWI space QC"
    description: |
      This section contains QC images for the registration of the T1-weighted
      structural image to diffusion space, using the b0 image as a reference.
      This step ensures accurate alignment between structural and diffusion
      data. To assess the quality of the registration, check for good alignment
      of anatomical structures. Specifically, look for proper overlay of cortical
      and subcortical structures without excessive warping, stretching,
      or misalignment. Pay particular attention to boundaries such as the
      ventricles and major white matter tracts, ensuring they match well
      between the T1-weighted and b0 images. If misalignment is present,
      consider flagging this specific subject for further review.
    plot_type: "image"
  metrics_qc:
    file_format: "tsv"
    section_name: "Metrics QC" # This is the new section name
    description: |
      This section contains QC images for diffusion tensor imaging
      (DTI) metric maps and FODF metric maps, including fractional anisotropy
      (FA), mean diffusivity (MD), RGB FA, and number of fiber orientation (NuFO).
      To assess the quality of the DTI metrics, ensure that FA highlights major
      white matter tracts with expected high values (e.g., corpus callosum,
      corticospinal tract) and that MD, RGB FA, and NuFO values follow known
      anatomical distributions. Look for smooth, artifact-free maps, avoiding
      unexpected signal dropout, distortions, or excessive noise. Pay special
      attention to regions prone to artifacts, such as near the ventricles or
      areas affected by eddy currents and susceptibility distortions.
    plot_type: "image"

sp:
  topup_qc:
    fn: "*_b0_topup_mqc.gif"
  eddy_qc:
    fn: "*_dwi_eddy_mqc.gif"
  anattodwi_qc:
    fn: "*_registration_anattodwi_mqc.gif"
  metrics_qc:
    fn: "*metrics_mqc.png"
  tracking_qc:
    fn: "*coverage_overlay_mqc.png"

export_plots: true

disable_version_detection: false
